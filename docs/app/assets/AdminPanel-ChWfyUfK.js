import{u as L,a as _,A as w,j as e}from"./index-StzU0Dlp.js";import{r as c,R as z,e as ce,b as B,X as F,Y as J,T as P,L as q,f as de,B as H,c as X,P as xe,a as me,C as ue}from"./charts-vendor-OydaLZmL.js";import{R as $,t as he,u as pe,h as ge,E as je,L as be,v as fe,T as V,X as W,w as Q,x as Y,P as ye,S as Z,a as ve,D as K,F as Ne,U as ee,y as se,k as we,B as te,z as ke}from"./icons-vendor-e87K8PwW.js";import"./react-vendor-C0Dkio3Y.js";import"./pdf-vendor-CtlUXWgY.js";const Ce=()=>{const{user:y,token:l}=L(),{modules:u}=_(),[k,h]=c.useState([]),[p,o]=c.useState(!0),[i,x]=c.useState(!1),[g,C]=c.useState(!1),[S,E]=c.useState(!1),[A,D]=c.useState(null),[t,b]=c.useState(!1),[s,v]=c.useState(""),[r,m]=c.useState("all"),[f,N]=c.useState("all"),[d,U]=c.useState({username:"",role:"user",modules:[],isActive:!0}),R=a=>{switch(a){case"admin":return["dashboard","transactions","products","clients","reports","metas","dre","admin"];case"user":return["dashboard","transactions","products","clients","reports","metas","dre"];case"guest":return["dashboard","metas","reports","dre"];default:return[]}};c.useEffect(()=>{M()},[]);const M=async()=>{try{o(!0);const n=await(await fetch(`${w}/admin/users`,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})).json();n.success&&h(n.data)}catch(a){console.error("Erro ao carregar usuários:",a)}finally{o(!1)}},ae=async()=>{try{const n=await(await fetch(`${w}/admin/users`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(d)})).json();if(n.success){x(!1);const j=R("user");U({username:"",role:"user",modules:j,isActive:!0}),M()}else alert(n.error||"Erro ao criar usuário")}catch(a){console.error("Erro ao criar usuário:",a),alert("Erro ao criar usuário")}},I=async(a,n)=>{try{const T=await(await fetch(`${w}/admin/users/${a}`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(n)})).json();T.success?M():alert(T.error||"Erro ao atualizar usuário")}catch(j){console.error("Erro ao atualizar usuário:",j),alert("Erro ao atualizar usuário")}},re=async a=>{if(confirm("Tem certeza que deseja deletar este usuário?"))try{const j=await(await fetch(`${w}/admin/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})).json();j.success?M():alert(j.error||"Erro ao deletar usuário")}catch(n){console.error("Erro ao deletar usuário:",n),alert("Erro ao deletar usuário")}},ne=(a,n)=>{const j=k.find(O=>O.id===a);if(!j)return;const T=j.modules||[],oe=T.includes(n)?T.filter(O=>O!==n):[...T,n];I(a,{modules:oe})},ie=async()=>{E(!0);try{const n=await(await fetch(`${w}/auth/reset-all-passwords`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})).json();n.success?(alert(`✅ ${n.message}

${n.resetCount} usuário(s) precisarão fazer primeiro login novamente.`),C(!1),M()):alert(n.error||"Erro ao resetar senhas")}catch(a){console.error("Erro ao resetar senhas:",a),alert("Erro ao resetar senhas")}finally{E(!1)}},le=async()=>{if(A){b(!0);try{const n=await(await fetch(`${w}/auth/reset-first-login`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({username:A.username})})).json();n.success?(alert(`✅ ${n.message}`),D(null),M()):alert(n.error||"Erro ao resetar senha")}catch(a){console.error("Erro ao resetar senha:",a),alert("Erro ao resetar senha")}finally{b(!1)}}},G=k.filter(a=>{const n=a.username.toLowerCase().includes(s.toLowerCase()),j=r==="all"||a.role===r,T=f==="all"||f==="active"&&a.isActive!==!1||f==="inactive"&&a.isActive===!1;return n&&j&&T});return p?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Gerenciar Usuários"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Resetar senhas de todos os usuários",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),"Resetar Todas as Senhas"]}),e.jsxs("button",{onClick:()=>{const a=R("user");U({username:"",role:"user",modules:a,isActive:!0}),x(!0)},className:"flex items-center px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors",children:[e.jsx(he,{className:"h-5 w-5 mr-2"}),"Novo Usuário"]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por username...",value:s,onChange:a=>v(a.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("select",{value:r,onChange:a=>m(a.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"all",children:"Todas as funções"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"guest",children:"Convidado"})]}),e.jsxs("select",{value:f,onChange:a=>N(a.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"all",children:"Todos os status"}),e.jsx("option",{value:"active",children:"Ativo"}),e.jsx("option",{value:"inactive",children:"Inativo"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-amber-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Função"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Módulos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Último Login"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.username}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Criado em ",new Date(a.createdAt).toLocaleDateString()]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:a.role,onChange:n=>I(a.id,{role:n.target.value}),className:"text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"guest",children:"Convidado"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-2 max-w-md",children:u.filter(n=>n.isActive).map(n=>e.jsxs("button",{onClick:()=>ne(a.id,n.key),className:`px-2 py-1 text-xs rounded transition-colors ${(a.modules||[]).includes(n.key)?"bg-amber-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[n.name,(a.modules||[]).includes(n.key)?e.jsx(ge,{className:"inline ml-1 h-3 w-3"}):e.jsx(je,{className:"inline ml-1 h-3 w-3"})]},n.id))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${a.isActive!==!1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isActive!==!1?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.lastLogin?new Date(a.lastLogin).toLocaleString():"Nunca"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(a),className:"text-blue-600 hover:text-blue-800",title:"Resetar Senha",children:e.jsx($,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>I(a.id,{isActive:a.isActive===!1}),className:"text-amber-600 hover:text-amber-800",title:a.isActive!==!1?"Desativar":"Ativar",children:a.isActive!==!1?e.jsx(be,{className:"h-5 w-5"}):e.jsx(fe,{className:"h-5 w-5"})}),a.id!==y?.id&&e.jsx("button",{onClick:()=>re(a.id),className:"text-red-600 hover:text-red-800",title:"Deletar",children:e.jsx(V,{className:"h-5 w-5"})})]})})]},a.id))})]})}),G.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum usuário encontrado"})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Novo Usuário"}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Username",value:d.username,onChange:a=>U({...d,username:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Função"}),e.jsxs("select",{value:d.role,onChange:a=>{const n=a.target.value,j=R(n);U({...d,role:n,modules:j})},className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"guest",children:"Convidado"})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-amber-800 mb-2",children:[e.jsx("strong",{children:"ℹ️ Informação:"})," A senha será gerada automaticamente no primeiro acesso do usuário e exibida no modal de login."]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-xs font-medium text-amber-900 mb-1",children:["Módulos pré-selecionados para ",d.role==="admin"?"Admin":d.role==="user"?"Usuário":"Convidado",":"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.modules.map(a=>{const n=u.find(j=>j.key===a);return n?e.jsx("span",{className:"px-2 py-1 text-xs bg-amber-200 text-amber-900 rounded",children:n.name},a):null})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{onClick:ae,className:"px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600",children:[e.jsx(Q,{className:"inline h-4 w-4 mr-1"}),"Criar"]})]})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Y,{className:"h-6 w-6 text-red-500 mr-3"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Confirmar Reset de Senhas"})]}),e.jsxs("p",{className:"text-gray-700 mb-6",children:["Tem certeza que deseja resetar as senhas de ",e.jsx("strong",{children:"todos os usuários"}),"?",e.jsx("br",{}),e.jsx("br",{}),"Todos os usuários precisarão fazer primeiro login novamente e receberão uma nova senha gerada automaticamente."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>C(!1),disabled:S,className:"px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:ie,disabled:S,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50 flex items-center",children:S?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Resetando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Confirmar Reset"]})})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Y,{className:"h-6 w-6 text-blue-500 mr-3"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Confirmar Reset de Senha"})]}),e.jsxs("p",{className:"text-gray-700 mb-6",children:["Tem certeza que deseja resetar a senha do usuário ",e.jsx("strong",{children:A.username}),"?",e.jsx("br",{}),e.jsx("br",{}),"O usuário precisará fazer primeiro login novamente e receberá uma nova senha gerada automaticamente."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>D(null),disabled:t,className:"px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:le,disabled:t,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 flex items-center",children:t?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Resetando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Confirmar Reset"]})})]})]})})]})},Se=()=>{const{token:y}=L(),{modules:l,loadModules:u}=_(),[k,h]=c.useState(!1),[p,o]=c.useState(null),[i,x]=c.useState({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0});c.useEffect(()=>{u()},[]);const g=async()=>{try{const b=await(await fetch(`${w}/admin/modules`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({...i,route:i.route||null})})).json();b.success?(h(!1),x({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0}),u()):alert(b.error||"Erro ao criar módulo")}catch(t){console.error("Erro ao criar módulo:",t),alert("Erro ao criar módulo")}},C=async(t,b)=>{try{const v=await(await fetch(`${w}/admin/modules/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify(b)})).json();v.success?u():alert(v.error||"Erro ao atualizar módulo")}catch(s){console.error("Erro ao atualizar módulo:",s),alert("Erro ao atualizar módulo")}},S=async t=>{if(confirm("Tem certeza que deseja deletar este módulo?"))try{const s=await(await fetch(`${w}/admin/modules/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();s.success?u():alert(s.error||"Erro ao deletar módulo")}catch(b){console.error("Erro ao deletar módulo:",b),alert("Erro ao deletar módulo")}},E=t=>{o(t),x({name:t.name,key:t.key,icon:t.icon,description:t.description||"",route:t.route||"",isActive:t.isActive}),h(!0)},A=async()=>{if(p)try{const t={name:i.name,key:i.key,icon:i.icon,description:i.description,route:i.route||null,isActive:i.isActive};await C(p.id,t),h(!1),o(null),x({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0})}catch(t){console.error("Erro ao salvar edição:",t)}},D=["Home","DollarSign","Package","Users","BarChart3","Target","Shield","Settings","Activity","TrendingUp"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Gerenciar Módulos"}),e.jsxs("button",{onClick:()=>{o(null),x({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0}),h(!0)},className:"flex items-center px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors",children:[e.jsx(ye,{className:"h-5 w-5 mr-2"}),"Novo Módulo"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(t=>e.jsxs("div",{className:`bg-white rounded-lg shadow p-6 border-2 ${t.isSystem?"border-amber-300":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.isSystem&&e.jsx(Z,{className:"h-5 w-5 text-amber-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.name})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Key:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900 font-mono",children:t.key})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Ícone:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:t.icon})]}),t.description&&e.jsx("div",{children:e.jsx("span",{className:"text-sm text-gray-600",children:t.description})}),e.jsx("div",{children:e.jsx("span",{className:"text-xs text-gray-500",children:t.isSystem?"Módulo do Sistema":"Módulo Customizado"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(t.id,{isActive:!t.isActive}),className:"flex-1 px-3 py-2 text-sm border rounded-lg hover:bg-gray-50",children:t.isActive?"Desativar":"Ativar"}),e.jsx("button",{onClick:()=>E(t),className:"px-3 py-2 text-sm text-amber-600 hover:text-amber-800",title:"Editar",children:e.jsx(ve,{className:"h-4 w-4"})}),!t.isSystem&&e.jsx("button",{onClick:()=>S(t.id),className:"px-3 py-2 text-sm text-red-600 hover:text-red-800",title:"Deletar",children:e.jsx(V,{className:"h-4 w-4"})})]})]},t.id))}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:p?"Editar Módulo":"Novo Módulo"}),e.jsx("button",{onClick:()=>{h(!1),o(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{type:"text",placeholder:"Nome do módulo",value:i.name,onChange:t=>x({...i,name:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key (única)"}),e.jsx("input",{type:"text",placeholder:"key-do-modulo",value:i.key,onChange:t=>x({...i,key:t.target.value.toLowerCase().replace(/\s+/g,"-")}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",disabled:!!p}),p&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A key não pode ser alterada"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ícone (Lucide)"}),e.jsx("select",{value:i.icon,onChange:t=>x({...i,icon:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:D.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("textarea",{placeholder:"Descrição do módulo",value:i.description,onChange:t=>x({...i,description:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rota (opcional)"}),e.jsx("input",{type:"text",placeholder:"/rota-customizada",value:i.route,onChange:t=>x({...i,route:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:i.isActive,onChange:t=>x({...i,isActive:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm text-gray-700",children:"Módulo ativo"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{onClick:()=>{h(!1),o(null)},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{onClick:p?A:g,className:"px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600",children:[e.jsx(Q,{className:"inline h-4 w-4 mr-1"}),p?"Salvar":"Criar"]})]})]})]})})]})},Ae=()=>{const{token:y}=L(),{modules:l}=_(),[u,k]=c.useState([]),[h,p]=c.useState(!0),[o,i]=c.useState({userId:"",module:"",action:"",startDate:"",endDate:""}),[x,g]=c.useState(1),C=50;c.useEffect(()=>{S()},[o,x]);const S=async()=>{try{p(!0);const s=new URLSearchParams;o.userId&&s.append("userId",o.userId),o.module&&s.append("module",o.module),o.action&&s.append("action",o.action),o.startDate&&s.append("startDate",o.startDate),o.endDate&&s.append("endDate",o.endDate),s.append("limit",C.toString()),s.append("page",x.toString());const r=await(await fetch(`${w}/admin/activity-log?${s}`,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();r.success&&k(r.data)}catch(s){console.error("Erro ao carregar logs:",s)}finally{p(!1)}},E=s=>{const v=u.map(r=>({Usuário:r.username,Ação:r.action,Módulo:r.module,Tipo:r.entityType||"",Data:new Date(r.timestamp).toLocaleString(),Detalhes:JSON.stringify(r.details||{})}));if(s==="csv"){const r=Object.keys(v[0]||{}),m=[r.join(","),...v.map(U=>r.map(R=>`"${U[R]}"`).join(","))].join(`
`),f=new Blob([m],{type:"text/csv"}),N=window.URL.createObjectURL(f),d=document.createElement("a");d.href=N,d.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,d.click()}else{const r=JSON.stringify(v,null,2),m=new Blob([r],{type:"application/json"}),f=window.URL.createObjectURL(m),N=document.createElement("a");N.href=f,N.download=`activity-logs-${new Date().toISOString().split("T")[0]}.json`,N.click()}},A=()=>{i({userId:"",module:"",action:"",startDate:"",endDate:""}),g(1)},D={create:"Criar",edit:"Editar",delete:"Deletar",login:"Login",permission_change:"Mudança de Permissão"},t=Array.from(new Set(u.map(s=>s.username))),b=Array.from(new Set(u.map(s=>s.action)));return h?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Histórico de Atividades"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>E("csv"),className:"flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"Exportar CSV"]}),e.jsxs("button",{onClick:()=>E("json"),className:"flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"Exportar JSON"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Filtros"}),e.jsx("button",{onClick:A,className:"ml-auto text-sm text-amber-600 hover:text-amber-800",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usuário"}),e.jsxs("select",{value:o.userId,onChange:s=>{i({...o,userId:s.target.value}),g(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Todos"}),t.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Módulo"}),e.jsxs("select",{value:o.module,onChange:s=>{i({...o,module:s.target.value}),g(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Todos"}),l.map(s=>e.jsx("option",{value:s.key,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ação"}),e.jsxs("select",{value:o.action,onChange:s=>{i({...o,action:s.target.value}),g(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Todas"}),b.map(s=>e.jsx("option",{value:s,children:D[s]||s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:o.startDate,onChange:s=>{i({...o,startDate:s.target.value}),g(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:o.endDate,onChange:s=>{i({...o,endDate:s.target.value}),g(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-amber-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Ação"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Módulo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Entidade"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Data/Hora"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.action==="create"?"bg-green-100 text-green-800":s.action==="edit"?"bg-blue-100 text-blue-800":s.action==="delete"?"bg-red-100 text-red-800":s.action==="login"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:D[s.action]||s.action})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.module}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.entityType||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.timestamp).toLocaleString()})]},s.id))})]})}),u.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum log encontrado"}),u.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",u.length," registro(s)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(s=>Math.max(1,s-1)),disabled:x===1,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:["Página ",x]}),e.jsx("button",{onClick:()=>g(s=>s+1),disabled:u.length<C,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Próxima"})]})]})]})]})},De=()=>{const{token:y}=L(),[l,u]=c.useState(null),[k,h]=c.useState([]),[p,o]=c.useState(!0),[i,x]=c.useState("30"),[g,C]=c.useState(""),[S,E]=c.useState("");c.useEffect(()=>{A(),D()},[i,g,S]);const A=async()=>{try{o(!0);const m=await(await fetch(`${w}/admin/statistics`,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();m.success&&u(m.data)}catch(r){console.error("Erro ao carregar estatísticas:",r)}finally{o(!1)}},D=async()=>{try{let r="",m=new Date().toISOString().split("T")[0];if(i==="7"){const d=new Date;d.setDate(d.getDate()-7),r=d.toISOString().split("T")[0]}else if(i==="30"){const d=new Date;d.setDate(d.getDate()-30),r=d.toISOString().split("T")[0]}else if(i==="90"){const d=new Date;d.setDate(d.getDate()-90),r=d.toISOString().split("T")[0]}else i==="custom"&&(r=g,m=S||m);if(!r)return;const N=await(await fetch(`${w}/admin/statistics/usage-timeline?startDate=${r}&endDate=${m}&groupBy=day`,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();N.success&&h(N.data)}catch(r){console.error("Erro ao carregar timeline:",r)}},t=()=>{if(!l)return;const r={...l,timeline:k,exportedAt:new Date().toISOString()},m=JSON.stringify(r,null,2),f=new Blob([m],{type:"application/json"}),N=window.URL.createObjectURL(f),d=document.createElement("a");d.href=N,d.download=`statistics-${new Date().toISOString().split("T")[0]}.json`,d.click()},b=["#f59e0b","#ef4444","#10b981","#3b82f6","#8b5cf6","#ec4899"];if(p)return e.jsx("div",{className:"text-center py-8",children:"Carregando estatísticas..."});if(!l)return e.jsx("div",{className:"text-center py-8 text-red-600",children:"Erro ao carregar estatísticas"});const s=Object.entries(l.activity.byModule).map(([r,m])=>({name:r,actions:m.actions,users:m.users})),v=[{name:"Admin",value:l.users.byRole.admin},{name:"Usuário",value:l.users.byRole.user},{name:"Convidado",value:l.users.byRole.guest}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Estatísticas do Sistema"}),e.jsxs("button",{onClick:t,className:"flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"Exportar Relatório"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Usuários"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.users.total}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[l.users.active," ativos"]})]}),e.jsx(ee,{className:"h-12 w-12 text-amber-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ações (30 dias)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activity.actionsLast30Days}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.activity.totalActions," total"]})]}),e.jsx(se,{className:"h-12 w-12 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Módulos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.modules.total}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.modules.active," ativos"]})]}),e.jsx(we,{className:"h-12 w-12 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Dados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.data.transactions+l.data.products+l.data.clients}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Transações, Produtos, Clientes"})]}),e.jsx(te,{className:"h-12 w-12 text-purple-500"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Período:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x("7"),className:`px-4 py-2 rounded-lg transition-colors ${i==="7"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"7 dias"}),e.jsx("button",{onClick:()=>x("30"),className:`px-4 py-2 rounded-lg transition-colors ${i==="30"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"30 dias"}),e.jsx("button",{onClick:()=>x("90"),className:`px-4 py-2 rounded-lg transition-colors ${i==="90"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"90 dias"}),e.jsx("button",{onClick:()=>x("custom"),className:`px-4 py-2 rounded-lg transition-colors ${i==="custom"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Personalizado"})]}),i==="custom"&&e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("input",{type:"date",value:g,onChange:r=>C(r.target.value),className:"px-3 py-2 border rounded-lg"}),e.jsx("span",{className:"self-center",children:"até"}),e.jsx("input",{type:"date",value:S,onChange:r=>E(r.target.value),className:"px-3 py-2 border rounded-lg"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Timeline de Uso"}),e.jsx(z,{width:"100%",height:300,children:e.jsxs(ce,{data:k,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(J,{}),e.jsx(P,{}),e.jsx(q,{}),e.jsx(de,{type:"monotone",dataKey:"count",stroke:"#f59e0b",strokeWidth:2,name:"Ações"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Uso por Módulo"}),e.jsx(z,{width:"100%",height:300,children:e.jsxs(H,{data:s,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",tick:{fontSize:12}}),e.jsx(J,{}),e.jsx(P,{}),e.jsx(q,{}),e.jsx(X,{dataKey:"actions",fill:"#f59e0b",name:"Ações"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Usuários por Função"}),e.jsx(z,{width:"100%",height:300,children:e.jsxs(xe,{children:[e.jsx(me,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:r=>{const{name:m,percent:f}=r;return`${m}: ${((f||0)*100).toFixed(0)}%`},outerRadius:80,fill:"#8884d8",dataKey:"value",children:v.map((r,m)=>e.jsx(ue,{fill:b[m%b.length]},`cell-${m}`))}),e.jsx(P,{})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top 5 Usuários Mais Ativos"}),e.jsx(z,{width:"100%",height:300,children:e.jsxs(H,{data:l.activity.topUsers,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"username",tick:{fontSize:12}}),e.jsx(J,{}),e.jsx(P,{}),e.jsx(q,{}),e.jsx(X,{dataKey:"count",fill:"#10b981",name:"Ações"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Módulos Mais Usados"}),e.jsx("div",{className:"space-y-2",children:l.activity.topModules.map((r,m)=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:r.key}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r.count," ações"]})]},r.key))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Resumo de Dados"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:"Transações"}),e.jsx("span",{className:"text-lg font-bold text-amber-600",children:l.data.transactions})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:"Produtos"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:l.data.products})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:"Clientes"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:l.data.clients})]})]})]})]})]})},Re=()=>{const{user:y}=L(),[l,u]=c.useState("users");if(y?.role!=="admin")return e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-600 text-lg",children:"Acesso negado. Apenas administradores podem acessar este painel."})});const k=[{id:"users",name:"Usuários",icon:ee},{id:"modules",name:"Módulos",icon:ke},{id:"activity",name:"Atividades",icon:se},{id:"statistics",name:"Estatísticas",icon:te}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Z,{className:"h-8 w-8 text-amber-600"}),e.jsx("h1",{className:"text-3xl font-bold text-amber-900",children:"Painel Administrativo"})]}),e.jsx("p",{className:"text-gray-600",children:"Gerencie usuários, módulos e visualize estatísticas do sistema"})]}),e.jsx("div",{className:"flex space-x-2 border-b mb-6",children:k.map(h=>{const p=h.icon;return e.jsxs("button",{onClick:()=>u(h.id),className:`flex items-center px-6 py-3 border-b-2 transition-colors ${l===h.id?"border-amber-500 text-amber-600 font-semibold":"border-transparent text-gray-600 hover:text-amber-600"}`,children:[e.jsx(p,{className:"h-5 w-5 mr-2"}),h.name]},h.id)})}),e.jsxs("div",{className:"mt-6",children:[l==="users"&&e.jsx(Ce,{}),l==="modules"&&e.jsx(Se,{}),l==="activity"&&e.jsx(Ae,{}),l==="statistics"&&e.jsx(De,{})]})]})};export{Re as default};
