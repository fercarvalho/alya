import{u as T,a as B,A as C,j as e}from"./index-Hg6WtLhS.js";import{r as x,R as M,e as W,b as P,X as z,Y as O,T as $,L as I,f as Q,B as F,c as J,P as Z,a as ee,C as se}from"./charts-vendor-OydaLZmL.js";import{r as te,s as ae,h as re,E as ne,L as ie,t as le,T as q,X as K,u as _,P as oe,S as G,a as ce,D as R,F as de,U as H,v as X,k as xe,B as Y,w as me}from"./icons-vendor-k9uevXii.js";import"./react-vendor-C0Dkio3Y.js";import"./pdf-vendor-CtlUXWgY.js";const ue=()=>{const{user:y,token:i}=T(),{modules:u}=B(),[N,h]=x.useState([]),[j,o]=x.useState(!0),[n,c]=x.useState(!1),[p,A]=x.useState(""),[w,D]=x.useState("all"),[k,E]=x.useState("all"),[t,g]=x.useState({username:"",role:"user",modules:[],isActive:!0}),s=a=>{switch(a){case"admin":return["dashboard","transactions","products","clients","reports","metas","admin"];case"user":return["dashboard","transactions","products","clients","reports","metas"];case"guest":return["dashboard","metas","reports"];default:return[]}};x.useEffect(()=>{f()},[]);const f=async()=>{try{o(!0);const l=await(await fetch(`${C}/admin/users`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).json();l.success&&h(l.data)}catch(a){console.error("Erro ao carregar usuários:",a)}finally{o(!1)}},r=async()=>{try{const l=await(await fetch(`${C}/admin/users`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).json();if(l.success){c(!1);const b=s("user");g({username:"",role:"user",modules:b,isActive:!0}),f()}else alert(l.error||"Erro ao criar usuário")}catch(a){console.error("Erro ao criar usuário:",a),alert("Erro ao criar usuário")}},d=async(a,l)=>{try{const U=await(await fetch(`${C}/admin/users/${a}`,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(l)})).json();U.success?f():alert(U.error||"Erro ao atualizar usuário")}catch(b){console.error("Erro ao atualizar usuário:",b),alert("Erro ao atualizar usuário")}},S=async a=>{if(confirm("Tem certeza que deseja deletar este usuário?"))try{const b=await(await fetch(`${C}/admin/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).json();b.success?f():alert(b.error||"Erro ao deletar usuário")}catch(l){console.error("Erro ao deletar usuário:",l),alert("Erro ao deletar usuário")}},v=(a,l)=>{const b=N.find(L=>L.id===a);if(!b)return;const U=b.modules||[],V=U.includes(l)?U.filter(L=>L!==l):[...U,l];d(a,{modules:V})},m=N.filter(a=>{const l=a.username.toLowerCase().includes(p.toLowerCase()),b=w==="all"||a.role===w,U=k==="all"||k==="active"&&a.isActive!==!1||k==="inactive"&&a.isActive===!1;return l&&b&&U});return j?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Gerenciar Usuários"}),e.jsxs("button",{onClick:()=>{const a=s("user");g({username:"",role:"user",modules:a,isActive:!0}),c(!0)},className:"flex items-center px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"Novo Usuário"]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por username...",value:p,onChange:a=>A(a.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("select",{value:w,onChange:a=>D(a.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"all",children:"Todas as funções"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"guest",children:"Convidado"})]}),e.jsxs("select",{value:k,onChange:a=>E(a.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"all",children:"Todos os status"}),e.jsx("option",{value:"active",children:"Ativo"}),e.jsx("option",{value:"inactive",children:"Inativo"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-amber-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Função"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Módulos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Último Login"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.username}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Criado em ",new Date(a.createdAt).toLocaleDateString()]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:a.role,onChange:l=>d(a.id,{role:l.target.value}),className:"text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"guest",children:"Convidado"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-2 max-w-md",children:u.filter(l=>l.isActive).map(l=>e.jsxs("button",{onClick:()=>v(a.id,l.key),className:`px-2 py-1 text-xs rounded transition-colors ${(a.modules||[]).includes(l.key)?"bg-amber-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[l.name,(a.modules||[]).includes(l.key)?e.jsx(re,{className:"inline ml-1 h-3 w-3"}):e.jsx(ne,{className:"inline ml-1 h-3 w-3"})]},l.id))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${a.isActive!==!1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isActive!==!1?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.lastLogin?new Date(a.lastLogin).toLocaleString():"Nunca"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(a.id,{isActive:a.isActive===!1}),className:"text-amber-600 hover:text-amber-800",title:a.isActive!==!1?"Desativar":"Ativar",children:a.isActive!==!1?e.jsx(ie,{className:"h-5 w-5"}):e.jsx(le,{className:"h-5 w-5"})}),a.id!==y?.id&&e.jsx("button",{onClick:()=>S(a.id),className:"text-red-600 hover:text-red-800",title:"Deletar",children:e.jsx(q,{className:"h-5 w-5"})})]})})]},a.id))})]})}),m.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum usuário encontrado"})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Novo Usuário"}),e.jsx("button",{onClick:()=>c(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(K,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Username",value:t.username,onChange:a=>g({...t,username:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Função"}),e.jsxs("select",{value:t.role,onChange:a=>{const l=a.target.value,b=s(l);g({...t,role:l,modules:b})},className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"guest",children:"Convidado"})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-amber-800 mb-2",children:[e.jsx("strong",{children:"ℹ️ Informação:"})," A senha será gerada automaticamente no primeiro acesso do usuário e exibida no modal de login."]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-xs font-medium text-amber-900 mb-1",children:["Módulos pré-selecionados para ",t.role==="admin"?"Admin":t.role==="user"?"Usuário":"Convidado",":"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.modules.map(a=>{const l=u.find(b=>b.key===a);return l?e.jsx("span",{className:"px-2 py-1 text-xs bg-amber-200 text-amber-900 rounded",children:l.name},a):null})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{onClick:r,className:"px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600",children:[e.jsx(_,{className:"inline h-4 w-4 mr-1"}),"Criar"]})]})]})]})})]})},he=()=>{const{token:y}=T(),{modules:i,loadModules:u}=B(),[N,h]=x.useState(!1),[j,o]=x.useState(null),[n,c]=x.useState({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0});x.useEffect(()=>{u()},[]);const p=async()=>{try{const g=await(await fetch(`${C}/admin/modules`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({...n,route:n.route||null})})).json();g.success?(h(!1),c({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0}),u()):alert(g.error||"Erro ao criar módulo")}catch(t){console.error("Erro ao criar módulo:",t),alert("Erro ao criar módulo")}},A=async(t,g)=>{try{const f=await(await fetch(`${C}/admin/modules/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify(g)})).json();f.success?u():alert(f.error||"Erro ao atualizar módulo")}catch(s){console.error("Erro ao atualizar módulo:",s),alert("Erro ao atualizar módulo")}},w=async t=>{if(confirm("Tem certeza que deseja deletar este módulo?"))try{const s=await(await fetch(`${C}/admin/modules/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();s.success?u():alert(s.error||"Erro ao deletar módulo")}catch(g){console.error("Erro ao deletar módulo:",g),alert("Erro ao deletar módulo")}},D=t=>{o(t),c({name:t.name,key:t.key,icon:t.icon,description:t.description||"",route:t.route||"",isActive:t.isActive}),h(!0)},k=async()=>{if(j)try{const t={name:n.name,key:n.key,icon:n.icon,description:n.description,route:n.route||null,isActive:n.isActive};await A(j.id,t),h(!1),o(null),c({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0})}catch(t){console.error("Erro ao salvar edição:",t)}},E=["Home","DollarSign","Package","Users","BarChart3","Target","Shield","Settings","Activity","TrendingUp"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Gerenciar Módulos"}),e.jsxs("button",{onClick:()=>{o(null),c({name:"",key:"",icon:"Package",description:"",route:"",isActive:!0}),h(!0)},className:"flex items-center px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Novo Módulo"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(t=>e.jsxs("div",{className:`bg-white rounded-lg shadow p-6 border-2 ${t.isSystem?"border-amber-300":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.isSystem&&e.jsx(G,{className:"h-5 w-5 text-amber-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.name})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Key:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900 font-mono",children:t.key})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Ícone:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:t.icon})]}),t.description&&e.jsx("div",{children:e.jsx("span",{className:"text-sm text-gray-600",children:t.description})}),e.jsx("div",{children:e.jsx("span",{className:"text-xs text-gray-500",children:t.isSystem?"Módulo do Sistema":"Módulo Customizado"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(t.id,{isActive:!t.isActive}),className:"flex-1 px-3 py-2 text-sm border rounded-lg hover:bg-gray-50",children:t.isActive?"Desativar":"Ativar"}),e.jsx("button",{onClick:()=>D(t),className:"px-3 py-2 text-sm text-amber-600 hover:text-amber-800",title:"Editar",children:e.jsx(ce,{className:"h-4 w-4"})}),!t.isSystem&&e.jsx("button",{onClick:()=>w(t.id),className:"px-3 py-2 text-sm text-red-600 hover:text-red-800",title:"Deletar",children:e.jsx(q,{className:"h-4 w-4"})})]})]},t.id))}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:j?"Editar Módulo":"Novo Módulo"}),e.jsx("button",{onClick:()=>{h(!1),o(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx(K,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{type:"text",placeholder:"Nome do módulo",value:n.name,onChange:t=>c({...n,name:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key (única)"}),e.jsx("input",{type:"text",placeholder:"key-do-modulo",value:n.key,onChange:t=>c({...n,key:t.target.value.toLowerCase().replace(/\s+/g,"-")}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",disabled:!!j}),j&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A key não pode ser alterada"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ícone (Lucide)"}),e.jsx("select",{value:n.icon,onChange:t=>c({...n,icon:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:E.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("textarea",{placeholder:"Descrição do módulo",value:n.description,onChange:t=>c({...n,description:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rota (opcional)"}),e.jsx("input",{type:"text",placeholder:"/rota-customizada",value:n.route,onChange:t=>c({...n,route:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:n.isActive,onChange:t=>c({...n,isActive:t.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm text-gray-700",children:"Módulo ativo"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{onClick:()=>{h(!1),o(null)},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{onClick:j?k:p,className:"px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600",children:[e.jsx(_,{className:"inline h-4 w-4 mr-1"}),j?"Salvar":"Criar"]})]})]})]})})]})},pe=()=>{const{token:y}=T(),{modules:i}=B(),[u,N]=x.useState([]),[h,j]=x.useState(!0),[o,n]=x.useState({userId:"",module:"",action:"",startDate:"",endDate:""}),[c,p]=x.useState(1),A=50;x.useEffect(()=>{w()},[o,c]);const w=async()=>{try{j(!0);const s=new URLSearchParams;o.userId&&s.append("userId",o.userId),o.module&&s.append("module",o.module),o.action&&s.append("action",o.action),o.startDate&&s.append("startDate",o.startDate),o.endDate&&s.append("endDate",o.endDate),s.append("limit",A.toString()),s.append("page",c.toString());const r=await(await fetch(`${C}/admin/activity-log?${s}`,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();r.success&&N(r.data)}catch(s){console.error("Erro ao carregar logs:",s)}finally{j(!1)}},D=s=>{const f=u.map(r=>({Usuário:r.username,Ação:r.action,Módulo:r.module,Tipo:r.entityType||"",Data:new Date(r.timestamp).toLocaleString(),Detalhes:JSON.stringify(r.details||{})}));if(s==="csv"){const r=Object.keys(f[0]||{}),d=[r.join(","),...f.map(a=>r.map(l=>`"${a[l]}"`).join(","))].join(`
`),S=new Blob([d],{type:"text/csv"}),v=window.URL.createObjectURL(S),m=document.createElement("a");m.href=v,m.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,m.click()}else{const r=JSON.stringify(f,null,2),d=new Blob([r],{type:"application/json"}),S=window.URL.createObjectURL(d),v=document.createElement("a");v.href=S,v.download=`activity-logs-${new Date().toISOString().split("T")[0]}.json`,v.click()}},k=()=>{n({userId:"",module:"",action:"",startDate:"",endDate:""}),p(1)},E={create:"Criar",edit:"Editar",delete:"Deletar",login:"Login",permission_change:"Mudança de Permissão"},t=Array.from(new Set(u.map(s=>s.username))),g=Array.from(new Set(u.map(s=>s.action)));return h?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Histórico de Atividades"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>D("csv"),className:"flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Exportar CSV"]}),e.jsxs("button",{onClick:()=>D("json"),className:"flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Exportar JSON"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(de,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Filtros"}),e.jsx("button",{onClick:k,className:"ml-auto text-sm text-amber-600 hover:text-amber-800",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usuário"}),e.jsxs("select",{value:o.userId,onChange:s=>{n({...o,userId:s.target.value}),p(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Todos"}),t.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Módulo"}),e.jsxs("select",{value:o.module,onChange:s=>{n({...o,module:s.target.value}),p(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Todos"}),i.map(s=>e.jsx("option",{value:s.key,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ação"}),e.jsxs("select",{value:o.action,onChange:s=>{n({...o,action:s.target.value}),p(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Todas"}),g.map(s=>e.jsx("option",{value:s,children:E[s]||s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:o.startDate,onChange:s=>{n({...o,startDate:s.target.value}),p(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:o.endDate,onChange:s=>{n({...o,endDate:s.target.value}),p(1)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-amber-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Ação"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Módulo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Entidade"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-amber-900 uppercase tracking-wider",children:"Data/Hora"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.action==="create"?"bg-green-100 text-green-800":s.action==="edit"?"bg-blue-100 text-blue-800":s.action==="delete"?"bg-red-100 text-red-800":s.action==="login"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:E[s.action]||s.action})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.module}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.entityType||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.timestamp).toLocaleString()})]},s.id))})]})}),u.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum log encontrado"}),u.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",u.length," registro(s)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(s=>Math.max(1,s-1)),disabled:c===1,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:["Página ",c]}),e.jsx("button",{onClick:()=>p(s=>s+1),disabled:u.length<A,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Próxima"})]})]})]})]})},ge=()=>{const{token:y}=T(),[i,u]=x.useState(null),[N,h]=x.useState([]),[j,o]=x.useState(!0),[n,c]=x.useState("30"),[p,A]=x.useState(""),[w,D]=x.useState("");x.useEffect(()=>{k(),E()},[n,p,w]);const k=async()=>{try{o(!0);const d=await(await fetch(`${C}/admin/statistics`,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();d.success&&u(d.data)}catch(r){console.error("Erro ao carregar estatísticas:",r)}finally{o(!1)}},E=async()=>{try{let r="",d=new Date().toISOString().split("T")[0];if(n==="7"){const m=new Date;m.setDate(m.getDate()-7),r=m.toISOString().split("T")[0]}else if(n==="30"){const m=new Date;m.setDate(m.getDate()-30),r=m.toISOString().split("T")[0]}else if(n==="90"){const m=new Date;m.setDate(m.getDate()-90),r=m.toISOString().split("T")[0]}else n==="custom"&&(r=p,d=w||d);if(!r)return;const v=await(await fetch(`${C}/admin/statistics/usage-timeline?startDate=${r}&endDate=${d}&groupBy=day`,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();v.success&&h(v.data)}catch(r){console.error("Erro ao carregar timeline:",r)}},t=()=>{if(!i)return;const r={...i,timeline:N,exportedAt:new Date().toISOString()},d=JSON.stringify(r,null,2),S=new Blob([d],{type:"application/json"}),v=window.URL.createObjectURL(S),m=document.createElement("a");m.href=v,m.download=`statistics-${new Date().toISOString().split("T")[0]}.json`,m.click()},g=["#f59e0b","#ef4444","#10b981","#3b82f6","#8b5cf6","#ec4899"];if(j)return e.jsx("div",{className:"text-center py-8",children:"Carregando estatísticas..."});if(!i)return e.jsx("div",{className:"text-center py-8 text-red-600",children:"Erro ao carregar estatísticas"});const s=Object.entries(i.activity.byModule).map(([r,d])=>({name:r,actions:d.actions,users:d.users})),f=[{name:"Admin",value:i.users.byRole.admin},{name:"Usuário",value:i.users.byRole.user},{name:"Convidado",value:i.users.byRole.guest}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:"Estatísticas do Sistema"}),e.jsxs("button",{onClick:t,className:"flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Exportar Relatório"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Usuários"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.users.total}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[i.users.active," ativos"]})]}),e.jsx(H,{className:"h-12 w-12 text-amber-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ações (30 dias)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.activity.actionsLast30Days}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.activity.totalActions," total"]})]}),e.jsx(X,{className:"h-12 w-12 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Módulos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.modules.total}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.modules.active," ativos"]})]}),e.jsx(xe,{className:"h-12 w-12 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Dados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.data.transactions+i.data.products+i.data.clients}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Transações, Produtos, Clientes"})]}),e.jsx(Y,{className:"h-12 w-12 text-purple-500"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Período:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c("7"),className:`px-4 py-2 rounded-lg transition-colors ${n==="7"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"7 dias"}),e.jsx("button",{onClick:()=>c("30"),className:`px-4 py-2 rounded-lg transition-colors ${n==="30"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"30 dias"}),e.jsx("button",{onClick:()=>c("90"),className:`px-4 py-2 rounded-lg transition-colors ${n==="90"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"90 dias"}),e.jsx("button",{onClick:()=>c("custom"),className:`px-4 py-2 rounded-lg transition-colors ${n==="custom"?"bg-amber-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Personalizado"})]}),n==="custom"&&e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("input",{type:"date",value:p,onChange:r=>A(r.target.value),className:"px-3 py-2 border rounded-lg"}),e.jsx("span",{className:"self-center",children:"até"}),e.jsx("input",{type:"date",value:w,onChange:r=>D(r.target.value),className:"px-3 py-2 border rounded-lg"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Timeline de Uso"}),e.jsx(M,{width:"100%",height:300,children:e.jsxs(W,{data:N,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(O,{}),e.jsx($,{}),e.jsx(I,{}),e.jsx(Q,{type:"monotone",dataKey:"count",stroke:"#f59e0b",strokeWidth:2,name:"Ações"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Uso por Módulo"}),e.jsx(M,{width:"100%",height:300,children:e.jsxs(F,{data:s,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",tick:{fontSize:12}}),e.jsx(O,{}),e.jsx($,{}),e.jsx(I,{}),e.jsx(J,{dataKey:"actions",fill:"#f59e0b",name:"Ações"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Usuários por Função"}),e.jsx(M,{width:"100%",height:300,children:e.jsxs(Z,{children:[e.jsx(ee,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:r=>{const{name:d,percent:S}=r;return`${d}: ${((S||0)*100).toFixed(0)}%`},outerRadius:80,fill:"#8884d8",dataKey:"value",children:f.map((r,d)=>e.jsx(se,{fill:g[d%g.length]},`cell-${d}`))}),e.jsx($,{})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top 5 Usuários Mais Ativos"}),e.jsx(M,{width:"100%",height:300,children:e.jsxs(F,{data:i.activity.topUsers,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"username",tick:{fontSize:12}}),e.jsx(O,{}),e.jsx($,{}),e.jsx(I,{}),e.jsx(J,{dataKey:"count",fill:"#10b981",name:"Ações"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Módulos Mais Usados"}),e.jsx("div",{className:"space-y-2",children:i.activity.topModules.map((r,d)=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:r.key}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r.count," ações"]})]},r.key))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Resumo de Dados"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:"Transações"}),e.jsx("span",{className:"text-lg font-bold text-amber-600",children:i.data.transactions})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:"Produtos"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:i.data.products})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:"Clientes"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:i.data.clients})]})]})]})]})]})},Ne=()=>{const{user:y}=T(),[i,u]=x.useState("users");if(y?.role!=="admin")return e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-600 text-lg",children:"Acesso negado. Apenas administradores podem acessar este painel."})});const N=[{id:"users",name:"Usuários",icon:H},{id:"modules",name:"Módulos",icon:me},{id:"activity",name:"Atividades",icon:X},{id:"statistics",name:"Estatísticas",icon:Y}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(G,{className:"h-8 w-8 text-amber-600"}),e.jsx("h1",{className:"text-3xl font-bold text-amber-900",children:"Painel Administrativo"})]}),e.jsx("p",{className:"text-gray-600",children:"Gerencie usuários, módulos e visualize estatísticas do sistema"})]}),e.jsx("div",{className:"flex space-x-2 border-b mb-6",children:N.map(h=>{const j=h.icon;return e.jsxs("button",{onClick:()=>u(h.id),className:`flex items-center px-6 py-3 border-b-2 transition-colors ${i===h.id?"border-amber-500 text-amber-600 font-semibold":"border-transparent text-gray-600 hover:text-amber-600"}`,children:[e.jsx(j,{className:"h-5 w-5 mr-2"}),h.name]},h.id)})}),e.jsxs("div",{className:"mt-6",children:[i==="users"&&e.jsx(ue,{}),i==="modules"&&e.jsx(he,{}),i==="activity"&&e.jsx(pe,{}),i==="statistics"&&e.jsx(ge,{})]})]})};export{Ne as default};
